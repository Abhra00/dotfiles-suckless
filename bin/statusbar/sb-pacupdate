#!/usr/bin/env bash

cache_file="${XDG_CACHE_HOME:-$HOME/.cache}/pkg_updates"

pacman_updates=$(checkupdates 2>/dev/null | wc -l)

if command -v yay &>/dev/null; then
    aur_updates=$(yay -Qum 2>/dev/null | wc -l)
elif command -v paru &>/dev/null; then
    aur_updates=$(paru -Qum 2>/dev/null | wc -l)
else
    aur_updates=0
fi

total_updates=$((pacman_updates + aur_updates))

notify-send "Total $total_updates packages can be upgraded" -i "$HOME/.config/dunst/assets/pacman.png"

echo "$total_updates" >"$cache_file"

dwmblocks_pid=$(pidof dwmblocks)
[ -n "$dwmblocks_pid" ] && kill -46 "$dwmblocks_pid"
